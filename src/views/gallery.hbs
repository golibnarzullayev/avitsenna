<style>
  .news-header {
      background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.3) 100%), url('assets/img/virtual-tour-2.jpg');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 5rem 0;
      margin-bottom: 3rem;
      position: relative;
    }
    
    .news-header h1 {
      font-weight: 700;
      font-size: 3rem;
      letter-spacing: -0.5px;
    }
    
    .news-header p {
      max-width: 600px;
      margin: 0 auto;
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .gallery-title {
        position: relative;
        text-align: center;
        margin-bottom: 50px;
    }
    
    .gallery-title:after {
        content: "";
        position: absolute;
        width: 100px;
        height: 4px;
        background-color: #3498db;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
    }
    
    .gallery-filter {
        margin-bottom: 30px;
    }
    
    .gallery-filter .btn {
        margin: 5px;
        text-transform: uppercase;
        font-weight: 500;
        letter-spacing: 1px;
    }
    
    .gallery-filter .btn.active {
        background-color: #3498db;
        border-color: #3498db;
        color: white;
    }
    
    .gallery-item {
        position: relative;
        margin-bottom: 30px;
        overflow: hidden;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .gallery-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    
    .gallery-item img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        transition: all 0.5s ease;
    }
    
    .gallery-item:hover img {
        transform: scale(1.05);
    }
    
    .gallery-item .caption {
        background: linear-gradient(0deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 15px;
        color: white;
    }
    
    .gallery-item .caption h5 {
        margin-bottom: 5px;
        font-weight: 600;
    }
    
    .gallery-item .caption p {
        font-size: 14px;
        margin-bottom: 0;
        opacity: 0.8;
    }
    
    @media (max-width: 767px) {
        .gallery-filter .btn {
            padding: 5px 10px;
            font-size: 12px;
        }
    }

            .modal-xl {
            max-width: 900px;
        }
        
        .modal-content {
            border: none;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .modal-header {
            border-bottom: none;
            background-color: rgba(0,0,0,0.03);
        }
        
        .modal-footer {
            border-top: none;
            background-color: rgba(0,0,0,0.03);
        }
        
        .modal-body {
            padding: 0;
        }
        
        .modal-body img {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        
        .modal-caption {
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
        }
        
        .modal-controls {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 15px;
            transform: translateY(-50%);
            z-index: 2;
        }
        
        .modal-controls button {
            background-color: rgba(255,255,255,0.7);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-controls button:hover {
            background-color: rgba(255,255,255,0.9);
        }
</style>
{{> navbar}}

<header class="news-header text-center">
  <div class="container">
    <h1 data-aos="fade-up">Maktabdan fotosuratlar</h1>
    <p data-aos="fade-up" data-aos-delay="100">Maktabimizning eng yorqin lahzalari va muhim tadbirlari</p>
  </div>
</header>

<section class="gallery-section">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="gallery-title">Fotogaleriya</h2>
            </div>
        </div>
      
        <!-- Gallery Items -->
        <div class="row gallery-container">
          {{#each galleries}}
            <!-- Tadbir 1 -->
            <div class="col-lg-4 col-md-6 gallery-item tadbir" 
              data-img="{{image}}" 
              data-title="{{title}}" 
              data-desc="{{description}}" 
              data-date="{{formatDate createdAt}}"
              data-index="{{@index}}">
              <div class="position-relative">
                  <img src="{{image}}" alt="Yillik konferensiya" class="img-fluid">
                  <div class="caption">
                      <h5>{{title}}</h5>
                      <p>{{formatDate createdAt}}</p>
                  </div>
              </div>
            </div>
            {{/each}}
        </div>
    </div>
</section>

<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title" id="imageModalLabel">Rasm sarlavhasi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body position-relative">
          <img src="" id="modalImage" class="img-fluid" alt="Modal Image">
          <div class="modal-controls">
              <button class="prev-img">&lsaquo;</button>
              <button class="next-img">&rsaquo;</button>
          </div>
      </div>
      <div class="modal-caption">
          <p id="modalDesc">Tavsif</p>
          <small id="modalDate" class="text-muted">Sana</small>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
      </div>
    </div>
  </div>
</div>

{{> footer}}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    // Check for required elements
    const filterButtons = document.querySelectorAll('.gallery-filter .btn');
    const galleryItems = document.querySelectorAll('.gallery-item');
    const imageModal = document.getElementById('imageModal');
    
    if (galleryItems.length === 0) {
        return;
    }
    
    if (!imageModal) {
        return;
    }
    
    // Get modal elements
    const modalTitle = document.getElementById('imageModalLabel');
    const modalImage = document.getElementById('modalImage');
    const modalDesc = document.getElementById('modalDesc');
    const modalDate = document.getElementById('modalDate');
    const prevButton = document.querySelector('.prev-img');
    const nextButton = document.querySelector('.next-img');
    
    // Check if Bootstrap is available
    let modal;
    try {
        // Check if Bootstrap is available
        if (typeof bootstrap === 'undefined') {
            // Fallback for modal functionality can be added here
        } else {
            modal = new bootstrap.Modal(imageModal);
        }
    } catch (error) {
        return;
    }
    
    // Filter button functionality
    if (filterButtons.length > 0) {
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to current button
                this.classList.add('active');
                
                // Get filter value
                const filterValue = this.getAttribute('data-filter');
                
                // Filter gallery items
                galleryItems.forEach(item => {
                    if (filterValue === 'all') {
                        item.style.display = 'block';
                    } else {
                        if (item.classList.contains(filterValue)) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    }
                });
            });
        });
    }
    
    // Gallery item click functionality
    galleryItems.forEach(item => {
        item.addEventListener('click', function() {
            const imgSrc = this.getAttribute('data-img');
            const title = this.getAttribute('data-title');
            const desc = this.getAttribute('data-desc');
            const date = this.getAttribute('data-date');
            const index = this.getAttribute('data-index');
            
            if (!imgSrc) {
                return;
            }
            
            // Update modal content
            if (modalTitle) modalTitle.textContent = title || '';
            if (modalImage) {
                modalImage.src = imgSrc;
                modalImage.setAttribute('data-index', index || '0');
            }
            if (modalDesc) modalDesc.textContent = desc || '';
            if (modalDate) modalDate.textContent = date || '';
            
            // Open modal
            if (modal) {
                modal.show();
            } else if (imageModal) {
                // Fallback if Bootstrap modal isn't available
                imageModal.style.display = 'block';
            }
        });
    });
    
    // Navigation function
    function navigateGallery(step) {
        if (!modalImage) return;
        
        const currentIndex = parseInt(modalImage.getAttribute('data-index') || '0');
        
        const visibleItems = Array.from(galleryItems).filter(item => {
            return window.getComputedStyle(item).display !== 'none';
        });
        
        if (visibleItems.length === 0) {
            return;
        }
        
        let newIndex = -1;
        
        // Find current item's position and calculate next position
        for (let i = 0; i < visibleItems.length; i++) {
            const itemIndex = parseInt(visibleItems[i].getAttribute('data-index') || '0');
            if (itemIndex === currentIndex) {
                let nextIdx = (i + step) % visibleItems.length;
                if (nextIdx < 0) nextIdx = visibleItems.length - 1;
                
                newIndex = parseInt(visibleItems[nextIdx].getAttribute('data-index') || '0');
                break;
            }
        }
        
        // Fallback to first item if current item not found
        if (newIndex === -1 && visibleItems.length > 0) {
            newIndex = parseInt(visibleItems[0].getAttribute('data-index') || '0');
        }
        
        // Update modal with new item
        const newItem = document.querySelector(`.gallery-item[data-index="${newIndex}"]`);
        if (newItem) {
            const imgSrc = newItem.getAttribute('data-img');
            const title = newItem.getAttribute('data-title');
            const desc = newItem.getAttribute('data-desc');
            const date = newItem.getAttribute('data-date');
            
            if (modalImage) modalImage.src = imgSrc || '';
            if (modalImage) modalImage.setAttribute('data-index', newIndex.toString());
            if (modalTitle) modalTitle.textContent = title || '';
            if (modalDesc) modalDesc.textContent = desc || '';
            if (modalDate) modalDate.textContent = date || '';
        }
    }
    
    // Previous button event listener
    if (prevButton) {
        prevButton.addEventListener('click', function() {
            navigateGallery(-1);
        });
    }
    
    // Next button event listener
    if (nextButton) {
        nextButton.addEventListener('click', function() {
            navigateGallery(1);
        });
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (imageModal && imageModal.classList.contains('show')) {
            if (e.key === 'ArrowLeft') {
                navigateGallery(-1);
            } else if (e.key === 'ArrowRight') {
                navigateGallery(1);
            } else if (e.key === 'Escape' && modal) {
                modal.hide();
            }
        }
    });
});
</script>